<p>[Notes written up Dec 29, 2017]</p>
<h1 id="depth">Depth</h1>
<p><img src="./imgs/depth_puck_s.jpg"></p>
<h2 id="background">Background</h2>
<p>We're currently in possession of the Blue Robotics pressure sensor useful for the 300 m depth range [REF].</p>
<p>The datasheet for this sensor [REF] indicates that it has an 'absolute accuracy' of +/- 50 mbar.</p>
<p>But: what does this mean?</p>
<p>Does this mean that the reading will drift +/- 50 mbar, over time?</p>
<p>It doesn't seem so -- because there is a separate figure quoted in the datasheet for how much drift to expect over time.</p>
<p>If, as seems reasonable, the sensor's pressure reading might be 'off' by a fixed amount within the range of +/- 50 mbar, then that 'offset' can be compensated for by simply 'zeroing' the sensor at an initial water depth and making measurements relative to that initial value.</p>
<p>Such a 'zeroing' procedure is easy to do, and needs to be done anyway for any deployment.</p>
<p>So: the important questions seem to be:</p>
<ul>
<li>How precise is the sensor?</li>
<li>How much does it drift over time?</li>
<li>How much does ambient pressure affect the measurement?</li>
</ul>
<h3 id="initial-test">Initial test</h3>
<p>The first thing to do was to simply place the depth sensor in a bucket.</p>
<p>After a very brief (a minute or so) placement of the sensor at the top of the bucket, it was plunged into the bucket.</p>
<p>Here are the results of about 100 hours of measurement:</p>
<p><img src="./imgs/pressure_comparison.png" width=1000></p>
<p>Notes:</p>
<ul>
<li><p>For the first few minutes, the sensor puck was placed above the bucket. This corresponds to the datapoints that can barely be seen at t=0, around 1053 mbar.</p></li>
<li><p>The sensor is then placed at the bottom of the bucket (full of water), bringing the reading up to 1080 mbar.</p></li>
<li><p>There is an initial rapid decay in sensor reading, which might be due to the pressure sensor being used for the first time -- or to e.g. an air bubble.</p></li>
<li><p>Then, after about t=3 hours, the pressure sensor seems to start drifting.</p></li>
<li><p>At about t=39 hours, the sensor was removed from the bucket, and then placed at a half-bucket position for an hour or two, before being replaced at the bottom of the bucket.</p></li>
<li><p>The sensor continues to drift, through a pressure range greater than the initial pressure difference between top- and bottom-of-bucket.</p></li>
<li><p>At t=40 hours, we start tracking ambient pressure, as well.</p></li>
<li><p>We notice that the qualitative behavior and absolute difference in pressure values track very well across both the ambient and water probe pressure values.</p></li>
</ul>
<h3 id="ambient-correction">Ambient correction</h3>
<p>Correcting the intial experiment was inconvenient -- two separate data streams were collected, resulting in timestamps that different slightly between the two signals. So, data capture was consolidated, aligning timestamps, facilitating ambient pressure compensation.</p>
<p>This resulted in the following data (generated by the script 'gnuplot -p pressure_corrected_progress.s')</p>
<p><img src="./imgs/pressure_progress_2017_12_29.png" width=1000></p>
<p>Notes:</p>
<ul>
<li><p>The water probe (purple) was initially placed above the bucket, resulting in a pressure of about t=1052 mbar at t=0 hours.</p></li>
<li><p>The water probe then jumps up to about 1078 mbar.</p></li>
<li><p>There is a gap in the data from t=2 hours to about t=16 hours (fiddling with data capture infrastructure).</p></li>
<li><p>Then we see that the water probe reading drifts over the next 40 hours from about 1080 mbar down to 1070 mbar. For tap water (assumed density 997 kg/m^3), this represents a depth change of about 10 centimeters.</p></li>
<li><p>Meanwhile, the ambient pressure (green) shows a similar behavior, and drift, over the same period.</p></li>
<li><p>By subtracting the ambient pressure from the probe pressure (and adding a pressure value simply to shift the result up visually for easy trend comparison), a relatively stable pressure reading result.</p></li>
</ul>
<p>By assuming a water density value (of 997 kg/m^3), we can then <a href="%5BReference%5D(https://www.grc.nasa.gov/www/k-12/WindTunnel/Activities/fluid_pressure.html)%20for%20calculating%20fluid%20height%20via%20pressure%20and%20density.%20I&#39;m%20assuming%20fluid%20density%20of%20997%20kg%20/%20m%5E3.">convert</a> this corrected pressure value to a depth reading (generated by gnuplot -p depth_corrected_progress.s):</p>
<p><img src="./imgs/depth_progress_2017_12_29.png" width=1000></p>
<p>Note that the apparent fluctuation of approximately 2 centimers may be due to the sensor, but also may be due to due to:</p>
<ol style="list-style-type: decimal">
<li><p>Evaporation of water from the bucket over 70 hours</p></li>
<li><p>Movement of the setup over the course of the 70 hour experiment. The bucket was moved, resulting in reorientation of the sensor puck within the bucket -- which could easily have changed the sensor depth by 2 cm or more.</p></li>
<li><p>Potential movement of the ambient pressure sensor. It was located on one of two nearby surfaces, which differ by more than 2 centimeters ...</p></li>
</ol>
<p><img src="./imgs/depth_rulerz_s.jpg"></p>
<h2 id="next-steps-for-depth-measurements">Next steps for depth measurements</h2>
<p>In order to more precisely assess the behavior of the pressure sensor, we will need to:</p>
<ul>
<li>anchor both ambient sensor and the water sensor</li>
<li>account for evaporation by measuring the water height independently.</li>
</ul>
<h1 id="conductivity">Conductivity</h1>
<p><img src="./imgs/probe_design_s.png"></p>
<h2 id="reducing-noise">Reducing noise</h2>
<p>Conductivity measurements were made with an audio jack probe. Initial tests indicated odd, periodic noise in the signal:</p>
<p><img src="./imgs/conductivity_before_decoupling.png" width=1000></p>
<p>Various strategies for reducing noise were applied to the setup:</p>
<ul>
<li>using a precision resistor rather than potentiometer as an amplification resistor</li>
<li>shortening long probe cables, to avoid capacitive effects</li>
<li>adding a protective insulating shroud around the probe to constrain field lines and produce consistent results across variations in probe position inside a small sample beaker</li>
</ul>
<p>Which nevertheless did not mitigate the drift.</p>
<p>Ultimately, the most significant source of drift seemed to be due to electrical coupling with 'house power', which had significant noise.</p>
<p>The setup was then placed on battery power, and data was transmitted over radio. This resulted in a significant reduction in noise, resulting in a very stable conductivity signal:</p>
<p><img src="./imgs/conductivity_decoupled.png" width=1000></p>
<p>The effective ADC resolution for this setup was about 1000 counts (the ADC could in principle range from &quot;zero conductivity&quot; at ~ 2000 ADU, to &quot;maximum conductivity&quot; at ~ 3000 ADU). The standard deviation over about 13 hours was ~ 0.5 ADU -- resulting in an error bar of about 0.05% of the effective measurement resolution.</p>
<h2 id="calibration">Calibration</h2>
<p>The conductivity sensor was then calibrated using solutions at 1413 uS/cm, 2000 uS/cm, and 3000 uS/cm:</p>
<p><img src="./imgs/conductivity_calibration.png" width=1000></p>
<p>The green line above is a linear fit via gnuplot of the form y=m*x+b, where:</p>
<p>b = 0.15355 +/- 0.002673 (1.741%)</p>
<p>c = 1956.42 +/- 6.986 (0.3571%)</p>
<p>Roughly, this seems to correspond to an anticipated error of around 7 uS/cm for conductivities around 2000 uS/cm, or about 0.4 % of the measurement value.</p>
<h2 id="next-steps-for-conductivity">Next steps for conductivity</h2>
<p>The probe circuitry seems to be quite stable over the long term, but there are preliminary indications from the latest experiments that the audio cable housing may have leaked.</p>
<p>The main next step, then, is to design and assemble a better probe -- likely with epoxy and metal screws, say, and to do further calibration assessments with that probe.</p>
<h1 id="firmware-used">Firmware used</h1>
<ul>
<li><p>Code for feather m0 lora -- provide square wave @ ~20 kHz for conductivity circuit (freq chosen to match historical choice, not necessarily optimal) -- measure temperature via thermistor -- then transmit via json packet (we're using radio so that we decouple any odd power source couplings as seemed to happen over usb): <a href="https://gist.github.com/dwblair/2b517428a16a0688a78964487ea80d20">Conductivity_temp_m0_lora_transmit_json.ino</a></p></li>
<li><p>Previous code that simply shows that we can combine pwm and lora code (there was a conflict with a timer function in an earlier version). To do: 'start' and 'stop' the timer so that we are not always pulsing the solution (avoid polarization effects); dial in arbitrary frequency via a nice function with a 'freq' parameter: <a href="https://gist.github.com/dwblair/c448957f44c1a48607a121f1aecbbcc7">Combining lora and pwm</a></p></li>
<li><p>Lora receive code that takes in packets and sends them over serial. Useful for putting lora feather m0 on USB port and using it as a 'passthrough': <a href="https://gist.github.com/dwblair/d912583478ffd3f4efd28e238f1005e3">m0_lora_receive.ino</a></p></li>
<li><p>Code for depth sensor using ms5837 and transmitting over max485 chip: <a href="https://gist.github.com/dwblair/cdbe6cdaf3c83865badefdc39568a504">row_depth_sensor_ms5837.ino</a></p></li>
<li><p>Code for ambient pressure and temp sensor, useful for compensating pressure fluctuations: <a href="https://gist.github.com/dwblair/602192bfc65250a26da9f316b5d9a4b5">row_bme280_ambient_pressure_sensor.ino</a></p></li>
</ul>
